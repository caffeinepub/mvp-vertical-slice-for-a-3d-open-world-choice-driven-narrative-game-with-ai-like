{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "3D narrative game MVP vertical slice (frontend)",
  "requirements": [
    {
      "id": "REQ-1",
      "summary": "Deliver a playable 3D game vertical slice in-browser: third-person movement/camera, a small neighborhood area with boundaries, and interactable NPCs that open dialogue and quest choices.",
      "acceptanceCriteria": [
        "A playable 3D scene loads in the browser with keyboard/mouse controls for movement and camera.",
        "At least 1 small open area exists (e.g., a neighborhood block) with basic collision/boundaries to prevent falling out of the world.",
        "At least 3 NPCs are placed in the world and can be interacted with (e.g., proximity + keypress) to open a dialogue UI.",
        "Completing at least 1 short quest changes the world state (e.g., an NPC moves, a flag changes, or a quest is marked completed)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/App.tsx",
          "operation": "create",
          "description": "Create the app shell that switches between Title, Character Creation, and in-game 3D play views; ensure the 3D game view is reachable and not orphaned."
        },
        {
          "path": "frontend/src/game/GameScreen.tsx",
          "operation": "create",
          "description": "Implement the main in-game screen for a 3D game: mount the renderer/canvas, manage input focus, show HUD elements, and host interaction prompts."
        },
        {
          "path": "frontend/src/game/engine/WorldCanvas.tsx",
          "operation": "create",
          "description": "Implement the 3D world renderer wrapper (e.g., Three.js-based) that loads the neighborhood scene, spawns player + NPCs, and exposes interaction hooks to UI."
        },
        {
          "path": "frontend/src/game/engine/playerControls.ts",
          "operation": "create",
          "description": "Implement keyboard movement and mouse camera controls suitable for third-person exploration; integrate with the 3D world update loop."
        },
        {
          "path": "frontend/src/game/content/worldNeighborhood.ts",
          "operation": "create",
          "description": "Define the small neighborhood block layout (ground plane, props, boundaries/colliders) in a structured format so the engine can build the scene."
        },
        {
          "path": "frontend/src/game/npc/npcPlacements.ts",
          "operation": "create",
          "description": "Define at least 3 NPC spawn points and base properties (name/id, initial position, initial behavior state)."
        },
        {
          "path": "frontend/src/game/ui/InteractionPrompt.tsx",
          "operation": "create",
          "description": "Add a small HUD prompt for proximity-based interaction (e.g., “Press E to talk”). Use shadcn-ui primitives for consistent styling; verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/game/state/useWorldRuntime.ts",
          "operation": "create",
          "description": "Create a runtime state hook that ticks world simulation, tracks player position, detects nearby interactables, and bridges to dialogue/quest systems."
        }
      ]
    },
    {
      "id": "REQ-2",
      "summary": "Add a character creation flow (name, appearance presets, and traits) and persist protagonist configuration for the logged-in user; make traits affect at least one in-game outcome.",
      "acceptanceCriteria": [
        "A character creation flow exists before gameplay (or via a menu) where the user can set at minimum: name, a few appearance options (e.g., hair/skin/outfit presets), and at least 3 personality/trait selections.",
        "The chosen customization is saved and reloaded on refresh/login.",
        "The customization impacts at least one in-game outcome (e.g., a dialogue option gated by a trait, or NPC affinity change magnitude influenced by a trait)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/auth/AuthGate.tsx",
          "operation": "create",
          "description": "Create an authentication gate using the authorization component expectations: require Internet Identity login before showing any personal game data; on logout clear cached state. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/profile/ProfileSetupModal.tsx",
          "operation": "create",
          "description": "Implement first-login profile name setup UI calling backend user profile methods; avoid principal display. Use shadcn-ui dialog/form components; verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/character/CharacterCreatorScreen.tsx",
          "operation": "create",
          "description": "Build the character creator flow (name input, appearance presets, and 3+ trait sliders/selectors) and a confirm action to persist protagonist config for the logged-in user."
        },
        {
          "path": "frontend/src/game/state/useProtagonist.ts",
          "operation": "create",
          "description": "Add a React Query hook layer to load/save protagonist configuration via the backend interface, and expose protagonist/traits to game systems."
        },
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Wire AuthGate + ProfileSetupModal + CharacterCreatorScreen into the app flow so character creation occurs before entering gameplay (or from a menu)."
        }
      ]
    },
    {
      "id": "REQ-3",
      "summary": "Implement a structured branching dialogue/choice system with trait/flag conditions and consequences that update persistent game state, including relationship/affinity changes displayed in UI.",
      "acceptanceCriteria": [
        "At least 2 separate dialogue scenes exist with branching choices (minimum 2 branches each).",
        "At least 1 choice sets a persistent flag that changes a later dialogue line or available option.",
        "At least 1 choice changes an NPC relationship/affinity value, and that value is displayed somewhere in UI.",
        "Dialogue content is stored in a structured form (e.g., a JSON-like schema in frontend or a Motoko data structure) rather than hardcoded directly in JSX strings per line."
      ],
      "file_operations": [
        {
          "path": "frontend/src/game/dialogue/dialogueTypes.ts",
          "operation": "create",
          "description": "Define a structured dialogue schema (nodes, lines, choices, conditions, and effects) to avoid hardcoding per-line JSX strings."
        },
        {
          "path": "frontend/src/game/content/dialogues.ts",
          "operation": "create",
          "description": "Author at least 2 dialogue scenes with branching choices using the structured schema; include conditions based on traits/flags and effects that set flags and change relationship values."
        },
        {
          "path": "frontend/src/game/dialogue/useDialogue.ts",
          "operation": "create",
          "description": "Create a dialogue controller hook that opens dialogue with an NPC, evaluates conditional choices, applies consequences, and syncs relevant state using the backend interface methods available."
        },
        {
          "path": "frontend/src/game/ui/DialoguePanel.tsx",
          "operation": "create",
          "description": "Implement the dialogue UI overlay (speaker name, lines, choice buttons, locked choice messaging). Use shadcn-ui components for layout/buttons; verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/game/ui/RelationshipWidget.tsx",
          "operation": "create",
          "description": "Add a small UI element that displays at least one NPC affinity/relationship value and updates as choices change it. Use shadcn-ui primitives; verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/game/GameScreen.tsx",
          "operation": "modify",
          "description": "Wire DialoguePanel opening/closing based on NPC interaction, and render RelationshipWidget in the in-game HUD."
        }
      ]
    },
    {
      "id": "REQ-4",
      "summary": "Create deterministic AI-like NPC behavior state machines with schedule/wander/idle reactions to player proximity and relationship/flag-driven dialogue availability (no external AI).",
      "acceptanceCriteria": [
        "Each NPC has a behavior state (e.g., idle/wander/talk/busy) that changes over time or due to player interaction.",
        "At least 1 NPC changes location based on an in-game time-of-day value or a quest flag.",
        "NPC dialogue options differ based on relationship value and/or quest flags.",
        "No third-party AI/LLM APIs are required to run NPC behaviors."
      ],
      "file_operations": [
        {
          "path": "frontend/src/game/npc/npcStateMachine.ts",
          "operation": "create",
          "description": "Implement deterministic NPC state machines (idle/wander/talk/busy), including transitions from time-of-day and player proximity."
        },
        {
          "path": "frontend/src/game/state/useGameClock.ts",
          "operation": "create",
          "description": "Add a lightweight in-game clock (time-of-day) that advances during play and is consumable by NPC schedules."
        },
        {
          "path": "frontend/src/game/npc/npcSchedules.ts",
          "operation": "create",
          "description": "Define per-NPC schedules and conditional schedule overrides based on quest flags (e.g., move to a different location after a quest step)."
        },
        {
          "path": "frontend/src/game/npc/npcDialogueAvailability.ts",
          "operation": "create",
          "description": "Centralize logic that determines which dialogue scene/options are available based on relationship values and quest flags, feeding the dialogue system."
        },
        {
          "path": "frontend/src/game/engine/WorldCanvas.tsx",
          "operation": "modify",
          "description": "Update the world simulation tick to advance NPC state machines, move NPCs in the world, and expose current NPC state (for talk/busy gating)."
        },
        {
          "path": "frontend/src/game/state/useWorldRuntime.ts",
          "operation": "modify",
          "description": "Integrate proximity reactions (e.g., NPC turns/greets, becomes ‘talk’ state) and ensure interactions respect NPC busy/talk states."
        }
      ]
    },
    {
      "id": "REQ-5",
      "summary": "Add quest definitions with objectives and branching outcomes plus a quest journal UI; persist quest progress/outcomes and let quests influence dialogue/NPC behaviors.",
      "acceptanceCriteria": [
        "A quest journal UI lists active/completed quests and current objectives.",
        "The MVP includes 1 main quest and 2 side quests with at least one branching outcome each.",
        "Quest completion and branching outcomes persist across refresh/login.",
        "Quest outcomes can modify dialogue availability and/or NPC behaviors."
      ],
      "file_operations": [
        {
          "path": "frontend/src/game/quests/questTypes.ts",
          "operation": "create",
          "description": "Define a structured quest schema (quests, objectives, branching outcomes) for the MVP slice."
        },
        {
          "path": "frontend/src/game/content/quests.ts",
          "operation": "create",
          "description": "Author 1 main quest and 2 side quests with objectives and at least one branching outcome each; include links to dialogue nodes/flags used elsewhere."
        },
        {
          "path": "frontend/src/game/quests/useQuestJournal.ts",
          "operation": "create",
          "description": "Implement a quest journal state hook that loads/saves quest progress using the backend interface methods, and exposes active/completed lists for UI."
        },
        {
          "path": "frontend/src/game/ui/QuestJournalPanel.tsx",
          "operation": "create",
          "description": "Build the quest journal UI (active/completed, current objectives, and branch outcome notes). Use shadcn-ui components; verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/game/state/useWorldRuntime.ts",
          "operation": "modify",
          "description": "Wire quest state updates from dialogue/interaction outcomes, and emit quest flags that can affect NPC schedules and dialogue availability."
        },
        {
          "path": "frontend/src/game/GameScreen.tsx",
          "operation": "modify",
          "description": "Add an in-game way to open/close the QuestJournalPanel (e.g., a HUD button or keybind) and ensure it does not conflict with movement input."
        }
      ]
    },
    {
      "id": "REQ-7",
      "summary": "Enforce content/compliance guardrails in all UI text/content: original names/locations only, adult tone without explicit sexual content, and show a brief originality disclaimer on title or settings.",
      "acceptanceCriteria": [
        "All user-facing names, factions, and locations in the MVP are original (no Y&R character names or show-specific identifiers).",
        "No explicit sexual content is present in dialogue, UI text, or assets.",
        "A brief disclaimer is shown on the title screen or in settings indicating the game is an original work inspired by soap-opera drama (generic phrasing, no trademark usage)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/game/content/dialogues.ts",
          "operation": "modify",
          "description": "Review and adjust dialogue content to ensure fully original characters/locations and adult-but-non-explicit tone (English only)."
        },
        {
          "path": "frontend/src/game/content/quests.ts",
          "operation": "modify",
          "description": "Review and adjust quest titles/descriptions/objectives to ensure fully original naming and non-explicit content (English only)."
        },
        {
          "path": "frontend/src/title/TitleScreen.tsx",
          "operation": "create",
          "description": "Create a title screen that displays an originality disclaimer (generic phrasing, no trademark usage) and entry points to login/start/continue."
        },
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Wire TitleScreen into the app flow so the disclaimer is shown prior to gameplay access."
        }
      ]
    },
    {
      "id": "REQ-8",
      "summary": "Apply a cohesive mature, dramatic UI theme (non-blue/purple primary colors) across title screen, character creator, dialogue UI, and quest journal UI.",
      "acceptanceCriteria": [
        "A consistent palette and typography system is applied across primary screens (title/menu, character creator, in-game HUD/dialogue, quest journal).",
        "The theme avoids default/basic styling and feels intentionally art-directed.",
        "The theme does not rely on blue/purple as the primary brand colors."
      ],
      "file_operations": [
        {
          "path": "frontend/src/index.css",
          "operation": "create",
          "description": "Define global theme tokens (CSS variables for Tailwind) and typography defaults for a mature dramatic look (e.g., charcoal/burgundy/gold accents); avoid blue/purple as primary."
        },
        {
          "path": "frontend/tailwind.config.js",
          "operation": "modify",
          "description": "Adjust Tailwind theme extensions if needed to support the chosen palette/typography consistently (keeping the existing CSS-variable-driven approach)."
        },
        {
          "path": "frontend/src/title/TitleScreen.tsx",
          "operation": "modify",
          "description": "Apply the theme consistently to the title screen layout and controls using shadcn-ui components where appropriate; verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/character/CharacterCreatorScreen.tsx",
          "operation": "modify",
          "description": "Apply the shared theme to character creation UI (forms, selectors, layout). Use shadcn-ui components; verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/game/ui/DialoguePanel.tsx",
          "operation": "modify",
          "description": "Apply the shared theme to the dialogue overlay (typography, choice buttons, panel styling). Use shadcn-ui components; verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/game/ui/QuestJournalPanel.tsx",
          "operation": "modify",
          "description": "Apply the shared theme to the quest journal panel (lists, objective styling, icons). Use shadcn-ui components; verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/public/assets/generated/title-bg.dim_1920x1080.png",
          "operation": "create",
          "description": "Add the generated title background image asset and wire it in TitleScreen (static asset)."
        },
        {
          "path": "frontend/public/assets/generated/logo-mark.dim_512x512.png",
          "operation": "create",
          "description": "Add the generated logo mark asset and wire it in TitleScreen (static asset)."
        },
        {
          "path": "frontend/public/assets/generated/journal-icons.dim_256x256.png",
          "operation": "create",
          "description": "Add the generated journal icon set asset and wire it into QuestJournalPanel UI (static asset)."
        }
      ]
    }
  ]
}